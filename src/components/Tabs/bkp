import React, { useState, useRef, useLayoutEffect } from 'react';
import { Text, StyleSheet, View, TouchableOpacity, Platform, Animated, Dimensions } from 'react-native';
import Icon from 'react-native-vector-icons/Ionicons';
import MaterialIcons from 'react-native-vector-icons/MaterialIcons';
import { createMaterialTopTabNavigator, MaterialTopTabBar } from '@react-navigation/material-top-tabs';
import { Searchbar } from 'react-native-paper';
import styles from './styles';

const Tab = createMaterialTopTabNavigator();
const { width: SCREEN_WIDTH } = Dimensions.get('window');

const DynamicTicketTabs = ({ navigation, title = 'Tabs', tabs = [] }) => {
  const [searchQuery, setSearchQuery] = useState('');
  const [isMounted, setIsMounted] = useState(false);
  const translateX = useRef(new Animated.Value(SCREEN_WIDTH)).current;

  const openSearch = () => {
    setIsMounted(true);
    Animated.timing(translateX, { toValue: 0, duration: 250, useNativeDriver: true }).start();
  };

  const closeSearch = () => {
    Animated.timing(translateX, { toValue: SCREEN_WIDTH, duration: 250, useNativeDriver: true }).start(() => {
      setIsMounted(false);
      setSearchQuery('');
    });
  };

  const onRefresh = () => {
    console.log('Refresh clicked');
  };

  useLayoutEffect(() => {
    navigation.setOptions({
      title,
      headerRight: () => (
        <View style={styles.headerIcons}>
          <TouchableOpacity onPress={onRefresh} style={styles.headerIconButton}>
            <MaterialIcons name="refresh" size={24} color="#fff" />
          </TouchableOpacity>
        </View>
      ),
    });
  }, [navigation, title]);

  const opacity = translateX.interpolate({ inputRange: [0, SCREEN_WIDTH], outputRange: [1, 0], extrapolate: 'clamp' });

  return (
    <View style={{ flex: 1 }}>
      <Tab.Navigator
        tabBar={(props) => (
          <View style={styles.tabBarWrapper}>
            <View style={{ flex: 1 }}>
              <MaterialTopTabBar {...props} />
            </View>
            <TouchableOpacity onPress={openSearch} style={styles.iconContainer}>
              <Icon name="search" size={22} color="#026367" />
            </TouchableOpacity>
            {isMounted && (
              <Animated.View style={[styles.searchOverlay, { transform: [{ translateX }], opacity }]}>
                <Searchbar
                  placeholder="Search"
                  value={searchQuery}
                  onChangeText={setSearchQuery}
                  style={styles.searchBar}
                  inputStyle={styles.searchInput}
                  iconColor="#026367"
                  placeholderTextColor="#000"
                  autoFocus
                  autoCorrect={false}
                  autoComplete="off"
                  spellCheck={false}
                />
                <TouchableOpacity onPress={closeSearch} style={styles.closeIcon}>
                  <Icon name="close" size={22} color="#026367" />
                </TouchableOpacity>
              </Animated.View>
            )}
          </View>
        )}
        screenOptions={({ route }) => ({
          tabBarLabel: ({ focused, color }) => {
            const tab = tabs.find(t => t.name === route.name);
            return (
              <Text style={[styles.tabLabel, { color, fontFamily: focused ? 'Roboto-Bold' : 'Roboto-Regular' }]}>
                {tab?.label || route.name}
              </Text>
            );
          },
          tabBarActiveTintColor: '#000',
          tabBarInactiveTintColor: '#000',
          tabBarIndicatorStyle: { backgroundColor: '#026367', height: 2 },
          tabBarStyle: { backgroundColor: 'transparent', elevation: 0 },
          tabBarItemStyle: { width: 95, paddingHorizontal: 0 },
          tabBarContentContainerStyle: { paddingHorizontal: 0 },
        })}
      >
        {tabs.map((tab) => (
          <Tab.Screen
            key={tab.name}
            name={tab.name}
            component={tab.component}
          />
        ))}
      </Tab.Navigator>
    </View>
  );
};

export default DynamicTicketTabs;



import { StyleSheet, Platform } from 'react-native';

const styles = StyleSheet.create({
  headerIcons: {
    flexDirection: 'row',
    alignItems: 'center',
    marginRight: 10,
  },
  headerIconButton: {
    paddingHorizontal: 8,
  },
  tabBarWrapper: {
    flexDirection: 'row',
    alignItems: 'center',
    position: 'relative',
    height: 56,
  },
  iconContainer: {
    paddingHorizontal: 12,
    justifyContent: 'center',
    alignItems: 'center',
  },
  tabLabel: {
    fontSize: 16,
    textTransform: 'none',
    fontFamily: 'Roboto-Regular',
  },
  searchOverlay: {
    position: 'absolute',
    top: 0,
    left: 0,
    height: 56,
    right: 0,
    flexDirection: 'row',
    alignItems: 'center',
    paddingHorizontal: 8,
    backgroundColor: '#f1f1f1ff',
    zIndex: 1000,
  },
  searchBar: {
    flex: 1,
    borderRadius: 20,
    elevation: 2,
    backgroundColor: '#f9f9f9',
    shadowColor: '#000',
    shadowOpacity: 0.05,
    shadowOffset: {
      width: 0,
      height: 1,
    },
    shadowRadius: 2,
  },
  searchInput: {
    fontSize: 16,
    marginBottom: Platform.OS === 'ios' ? 2 : 0,
  },
  closeIcon: {
    marginLeft: 8,
    padding: 6,
  },
});

export default styles;


import React, { useState, useRef, useEffect } from 'react';
import { View, Text, TouchableOpacity, Animated, Dimensions, StyleSheet, Platform, Modal } from 'react-native';
import Icon from 'react-native-vector-icons/Ionicons';
import MaterialIcons from 'react-native-vector-icons/MaterialIcons';
import { Searchbar } from 'react-native-paper';

const { width: SCREEN_WIDTH } = Dimensions.get('window');

const CustomTabs = ({ navigation, title = 'Tabs', tabs: initialTabs = [] }) => {
  const [activeTab, setActiveTab] = useState(initialTabs?.[0]?.name || '');
  const [searchQuery, setSearchQuery] = useState('');
  const [isSearchOpen, setIsSearchOpen] = useState(false);
  const [isMoreOptionsOpen, setIsMoreOptionsOpen] = useState(false);
  const [tabs, setTabs] = useState(initialTabs); // Local state for tabs
  const translateX = useRef(new Animated.Value(SCREEN_WIDTH)).current;
  const contentTranslateX = useRef(new Animated.Value(0)).current;
  const indicatorTranslateX = useRef(new Animated.Value(0)).current;
  const prevTabIndex = useRef(0);
  const [showIndicator, setShowIndicator] = useState(true);

  const getActiveTabIndex = (tabName) => {
    return tabs.findIndex((tab) => tab?.name === tabName);
  };

  const openSearch = () => {
    setIsSearchOpen(true);
    Animated.timing(translateX, {
      toValue: 0,
      duration: 250,
      useNativeDriver: true,
    }).start();
  };

  const closeSearch = () => {
    Animated.timing(translateX, {
      toValue: SCREEN_WIDTH,
      duration: 250,
      useNativeDriver: true,
    }).start(() => {
      setIsSearchOpen(false);
      setSearchQuery('');
    });
  };

  const onRefresh = () => {
    console.log('Refresh clicked');
  };

  const toggleMoreOptions = () => {
    setIsMoreOptionsOpen(!isMoreOptionsOpen);
  };

  React.useLayoutEffect(() => {
    navigation?.setOptions?.({
      title: title || 'Tabs',
      headerRight: () => (
        <View style={styles.headerIcons}>
          <TouchableOpacity onPress={onRefresh} style={styles.headerIconButton}>
            <MaterialIcons name="refresh" size={24} color="#fff" />
          </TouchableOpacity>
        </View>
      ),
    });
  }, [navigation, title]);

  const opacity = translateX.interpolate({
    inputRange: [0, SCREEN_WIDTH],
    outputRange: [1, 0],
    extrapolate: 'clamp',
  });

  const handleTabChange = (tabName, index) => {
    const currentIndex = getActiveTabIndex(activeTab);
    const isMovingRight = index > currentIndex;
    const slideOutDirection = isMovingRight ? -SCREEN_WIDTH : SCREEN_WIDTH;
    const slideInDirection = isMovingRight ? SCREEN_WIDTH : -SCREEN_WIDTH;

    let tabWidth = 95;
    let targetIndicatorPosition = index * tabWidth;

    // If the selected tab is from the modal (index >= 2 and tabs.length > 3)
    if (tabs.length > 3 && index >= 2) {
      // Swap the selected tab with the second tab (index 1)
      const newTabs = [...tabs];
      const temp = newTabs[1]; // Second tab
      newTabs[1] = newTabs[index]; // Replace second tab with selected tab
      newTabs[index] = temp; // Move original second tab to the modal
      setTabs(newTabs);

      // Since the selected tab is now at index 1, update the indicator position
      targetIndicatorPosition = 1 * tabWidth;
      index = 1; // Update index to reflect the new position of the selected tab
    }

    const shouldAnimateIndicator = !(tabs.length > 3 && index >= 2);

    // Update showIndicator based on whether a modal tab is selected
    setShowIndicator(tabs.length <= 3 || index < 2);

    Animated.parallel([
      Animated.sequence([
        Animated.timing(contentTranslateX, {
          toValue: slideOutDirection,
          duration: 250,
          useNativeDriver: true,
        }),
        Animated.timing(contentTranslateX, {
          toValue: slideInDirection,
          duration: 0,
          useNativeDriver: true,
        }),
        Animated.timing(contentTranslateX, {
          toValue: 0,
          duration: 250,
          useNativeDriver: true,
        }),
      ]),
      shouldAnimateIndicator &&
        Animated.timing(indicatorTranslateX, {
          toValue: targetIndicatorPosition,
          duration: 250,
          useNativeDriver: true,
        }),
    ].filter(Boolean)).start();

    prevTabIndex.current = index;
    setActiveTab(tabName);
  };

  const renderTabContent = () => {
    const activeTabData = tabs?.find?.((tab) => tab?.name === activeTab);
    return activeTabData?.component ? (
      <Animated.View
        style={[
          styles.tabContent,
          {
            transform: [{ translateX: contentTranslateX }],
            opacity: contentTranslateX.interpolate({
              inputRange: [-SCREEN_WIDTH, 0, SCREEN_WIDTH],
              outputRange: [0, 1, 0],
              extrapolate: 'clamp',
            }),
          },
        ]}
      >
        {React.createElement(activeTabData.component)}
      </Animated.View>
    ) : null;
  };

  const visibleTabs = tabs?.length <= 3 ? tabs : tabs?.slice?.(0, 2) ?? [];
  const moreTabs = tabs?.length > 3 ? tabs?.slice?.(2) ?? [] : [];

  return (
    <View style={styles.container}>
      <View style={styles.tabBarWrapper}>
        <View style={styles.tabBar}>
          {visibleTabs?.map?.((tab, index) => (
            <TouchableOpacity
              key={tab?.name ?? `tab-${index}`}
              style={[styles.tabItem, activeTab === tab?.name && styles.activeTab]}
              onPress={() => handleTabChange(tab?.name, index)}
            >
              <Text
                style={[
                  styles.tabLabel,
                  activeTab === tab?.name ? styles.activeTabLabel : styles.inactiveTabLabel,
                ]}
              >
                {tab?.label || tab?.name || 'Tab'}
              </Text>
            </TouchableOpacity>
          ))}
          {tabs?.length > 3 && (
            <TouchableOpacity style={[styles.tabItem,styles.moretabItem]} onPress={toggleMoreOptions}>
              <Icon name="ellipsis-horizontal" size={22} color="#026367" />
            </TouchableOpacity>
          )}
          {showIndicator && (
            <Animated.View
              style={[
                styles.tabIndicator,
                {
                  transform: [{ translateX: indicatorTranslateX }],
                },
              ]}
            />
          )}
        </View>
        <TouchableOpacity onPress={openSearch} style={styles.iconContainer}>
          <Icon name="search" size={22} color="#026367" />
        </TouchableOpacity>
        {isSearchOpen && (
          <Animated.View style={[styles.searchOverlay, { transform: [{ translateX }], opacity }]}>
            <Searchbar
              placeholder="Search"
              value={searchQuery}
              onChangeText={setSearchQuery}
              style={styles.searchBar}
              inputStyle={styles.searchInput}
              iconColor="#026367"
              placeholderTextColor="#000"
              autoFocus
              autoCorrect={false}
              autoComplete="off"
              spellCheck={false}
            />
            <TouchableOpacity onPress={closeSearch} style={styles.closeIcon}>
              <Icon name="close" size={22} color="#026367" />
            </TouchableOpacity>
          </Animated.View>
        )}
      </View>
      <Modal
        visible={isMoreOptionsOpen}
        transparent={true}
        animationType="fade"
        onRequestClose={toggleMoreOptions}
      >
        <TouchableOpacity
          style={styles.modalOverlay}
          activeOpacity={1}
          onPress={toggleMoreOptions}
        >
          <View style={styles.modalContent}>
            {moreTabs?.map?.((tab, index) => (
              <TouchableOpacity
                key={tab?.name ?? `more-tab-${index}`}
                style={styles.modalItem}
                onPress={() => {
                  handleTabChange(tab?.name, index + 2);
                  setIsMoreOptionsOpen(false);
                }}
              >
                <Text style={styles.modalItemText}>{tab?.label || tab?.name || 'Tab'}</Text>
              </TouchableOpacity>
            ))}
          </View>
        </TouchableOpacity>
      </Modal>
      <View style={styles.tabContentContainer}>{renderTabContent()}</View>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  headerIcons: {
    flexDirection: 'row',
    alignItems: 'center',
    marginRight: 10,
  },
  headerIconButton: {
    paddingHorizontal: 8,
  },
  tabBarWrapper: {
    flexDirection: 'row',
    alignItems: 'center',
    position: 'relative',
    height: 56,
    backgroundColor: 'transparent',
  },
  tabBar: {
    flex: 1,
    flexDirection: 'row',
    justifyContent: 'flex-start',
    position: 'relative',
  },
  tabItem: {
    width: 97,
    justifyContent: 'center',
    alignItems: 'center',
    paddingVertical: 8,
  },
  moretabItem: {
    width: 60,
  },
  tabLabel: {
    fontSize: 16,
    textTransform: 'none',
    fontFamily: 'Roboto-Regular',
  },
  activeTabLabel: {
    color: '#000',
    fontFamily: 'Roboto-Bold',
  },
  inactiveTabLabel: {
    color: '#000',
    fontFamily: 'Roboto-Regular',
  },
  tabIndicator: {
    position: 'absolute',
    bottom: 0,
    height: 2,
    width: 100,
    backgroundColor: '#026367',
  },
  iconContainer: {
    paddingHorizontal: 12,
    justifyContent: 'center',
    alignItems: 'center',
  },
  searchOverlay: {
    position: 'absolute',
    top: 0,
    left: 0,
    right: 0,
    height: 56,
    flexDirection: 'row',
    alignItems: 'center',
    paddingHorizontal: 8,
    backgroundColor: '#f1f1f1ff',
    zIndex: 1000,
  },
  searchBar: {
    flex: 1,
    borderRadius: 20,
    elevation: 2,
    backgroundColor: '#f9f9f9',
    shadowColor: '#000',
    shadowOpacity: 0.05,
    shadowOffset: { width: 0, height: 1 },
    shadowRadius: 2,
  },
  searchInput: {
    fontSize: 16,
    marginBottom: Platform.OS === 'ios' ? 2 : 0,
  },
  closeIcon: {
    marginLeft: 8,
    padding: 6,
  },
  tabContentContainer: {
    flex: 1,
    overflow: 'hidden',
  },
  tabContent: {
    flex: 1,
  },
  modalOverlay: {
    flex: 1,
    justifyContent: 'flex-start',
    alignItems: 'flex-start',
  },
  modalContent: {
    backgroundColor: '#fff',
    marginTop: 90,
    marginLeft: 170,
    borderRadius: 8,
    paddingVertical: 8,
    width: 130,
    elevation: 5,
    shadowColor: '#000',
    shadowOpacity: 0.2,
    shadowOffset: { width: 0, height: 2 },
    shadowRadius: 4,
  },
  modalItem: {
    paddingVertical: 8,
    paddingHorizontal: 16,
    alignItems: 'center',
  },
  modalItemText: {
    fontSize: 16,
    color: '#000',
    fontFamily: 'Roboto-Regular',
  },
});

export default CustomTabs;



import React, { useState } from 'react';
import { View, StyleSheet, Text, Button, Alert } from 'react-native';
import AzureAuth from 'react-native-azure-auth';

const azureAuth = new AzureAuth({
  clientId: 'fd715808-1c9c-4c98-9ddd-6c652f4f0da4',
  tenant: 'db23acaf-be24-4d51-9d6e-5a516262697c',
  redirectUri: 'msauth://com.helpdesk365/VzSiQcXRmi2kyjzcA%2BmYLEtbGVs%3D'
});

const LoginScreen = ({ title }) => {
  const [user, setUser] = useState(null);

  const signIn = async () => {
    try {
      const tokens = await azureAuth.webAuth.authorize({
        scope: 'openid profile User.Read'
      });
      const userInfo = await azureAuth.auth.msGraphRequest({
        token: tokens.accessToken,
        path: '/me'
      });
      setUser({ name: userInfo.displayName, id: tokens.userId });
      Alert.alert('Success', `Logged in as ${userInfo.displayName}`);
    } catch (error) {
      console.log('Authorization Error:', error);
      Alert.alert('Error', JSON.stringify(error, null, 2));
    }
  };

  const signOut = async () => {
    try {
      await azureAuth.webAuth.clearSession();
      setUser(null);
      Alert.alert('Success', 'Logged out successfully');
    } catch (error) {
      console.log('Sign out Error:', JSON.stringify(error, null, 2));
      Alert.alert('Error', 'Failed to sign out. Please try again.');
    }
  };

  return (
    <View style={styles.container}>
      {user ? (
        <>
          <Text style={styles.text}>Welcome, {user.name}</Text>
          <Button title="Sign Out" onPress={signOut} color="#026367" />
        </>
      ) : (
        <Button title="Sign In with Azure" onPress={signIn} color="#026367" />
      )}
    </View>
  );
};

export default LoginScreen;

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  text: {
    fontSize: 25,
    marginBottom: 20,
  },
});